AWSTemplateFormatVersion: 2010-09-09
Description: |
  This CloudFormation Template was written for running Kittens Carousel Static Website on EC2.
Parameters:
 keypair:
   Description: choose your keypair
   Type: AWS::EC2::KeyPair::KeyName
   Default: first-key
   Resources:
image:
    Description: choose your imageid
    Type: 'AWS::SSM::Parameter::Value<AWS::EC2::Image::Id>'
    Default: /aws/service/ami-amazon-linux-latest/al2023-ami-kernel-6.1-arm64
mysecgroup:
  Type: AWS::EC2::SecurityGroup
  Properties:
    GroupDescription: Allow ssh and http
    GroupName: nazli-sec-grp-20
    SecurityGroupIngress: 
    - CidrIp: 0.0.0.0/0
      FromPort: 22
      IpProtocol: tcp
      ToPort: 22

    - CidrIp: 0.0.0.0/0
      FromPort: 80
      IpProtocol: tcp
      ToPort: 80

mywebserver:
    Type: AWS::EC2::Instance
    Properties:
      ImageId: !Ref image
      InstanceType: t2.micro
      KeyName: !Ref keypair
      SecurityGroupIds: 
        - !Ref mysecgroup
  
     
      Tags: 
        - Key: Name
          Value: !Sub Web server of ${AWS::StackName}
     
      UserData: !Base64 |
       #! /bin/bash
       dnf update -y
       dnf install httpd -y
       FOLDER =  'https://raw.githubusercontent.com/nazlinurkaya/aws-project-20/refs/heads/main/101-kittens-carousel-static-website-ec2/static-web'
       cd /var/wwww/html
       wget ${FOLDER}/index.html
       wget ${FOLDER}/cat0.jpg
       wget ${FOLDER}/cat1.jpg
       wget ${FOLDER}/cat2.jpg
       systemctl start httpd 
       systemctl enable httpd 

  
Outputs:
 WebSiteURL:
  Description: URL of  WebSiteURL
  Value: !Sub
    http://${PublicDNS}
    PublicDNS: !GetAtt mywebserver.PublicDnsName